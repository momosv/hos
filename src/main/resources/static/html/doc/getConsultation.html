<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会诊详情</title>
    <link rel="stylesheet" href="/css/common.css">
    <script src="/webjars/jquery/1.11.1/jquery.min.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/doc/case.js"></script>
    <style type="text/css">
        #head,#user,#case,#save_btn{
            width: 1100px;
            margin: 0 auto;
            border: 1px orchid solid;
        }
    </style>
    <script language="JavaScript">
        $(function () {
            getCaseSecondDetail();
            getConsultation();
        });


        function updateConsultation() {
            $.ajax({
                url: "/doc/updateConsultation",
                type: 'POST',
                data: {
                    Id: $("#secondId").val(),
                    createTime: $("#conDate").val(),
                    hosAndDept: $("#hosAndDept").val(),
                    doctors: $("#doctors").val(),
                    aim: $("#aim").val(),
                    summary: $("#summary").val(),
                    phyExam: $("#phyExam").val(),
                    medicalRecord: $("#medicalRecord").val(),
                    opinion: $("#opinion").val(),
                    suggestion:  $("#suggestion").val(),
                    remark:  $("#remark").val()
                },
                success: function (re) {
                    if(re.code==-1){
                        window.open("/hos/login");
                        jQuery.alertWindow("登录已经失效，请重新登录！",10000);
                    }else if (re.code != 200) {
                        jQuery.alertWindow("保存成功");
                    }else {
                        jQuery.alertWindow(re.msg);
                    }
                }
            });
        }
        function getConsultation() {
            $.ajax({
                url: "/doc/getConsultation",
                type: 'POST',
                data: {
                    id: $("#secondId").val()
                },
                success: function (re) {
                    if (re.code == -1) {
                        window.open("/hos/login");
                        jQuery.alertWindow("登录已经失效，请重新登录！",10000);
                    } else if (re.code != 200) {
                        var detail =re.extend.detail;
                        $("#conDate").val(new Date(detail.createTime).Format("yyyy-MM-ddThh:mm"));
                        $("#summary").val(detail.summary);
                        $("#phyExam").val(detail.phyExam);
                        $("#medicalRecord").val(detail.medicalRecord);
                        $("#remark").val(detail.remark);
                        $("#hosAndDept").val(detail.hosAndDept);
                        $("#doctors").val(detail.doctors);
                        $("#aim").val(detail.aim);
                        $("#opinion").val(detail.opinion);
                        $("#suggestion").val(detail.suggestion);
                    } else {
                        jQuery.alertWindow(re.msg);
                    }
                }
            });
        }

    </script>
</head>
<body>
<div id="head" style="height: 100px;text-align: center;font-size: 44px;padding-top: 30px;color:#000;">
    <span id="title0">会诊详情</span>
    <input type="hidden" id="patientId" >
    <input type="hidden" id="caseId" value="${caseId}" >
    <input type="hidden" id="secondId" value="${secondId}" >
</div>
<div id="user" style="">
    <table style="height: 200px">
        <tr>
            <td>科别：<input type="text" id="deptName" value="${deptName}"></td>
            <td>初诊时间：<input id="caseDate1" type="datetime-local"  format="yyyy-MM-ddThh:mm" value=""></td>
            <td>会诊时间：<input id="conDate" type="datetime-local"  format="yyyy-MM-ddThh:mm" value=""></td>
            <td>门诊卡号：<input id="treatCode" type="text" value=""></td>

        </tr>
        <tr>
            <td>姓名：<input id="name" type="text" value=""></td>
            <td>性别：<select id="sex"><option id="sex0"  value="0">女</option><option id="sex1" value="1">男</option></select></td>
            <td>出生日期：<input id="birthday" type="date" format="yyyy-MM-dd" value="" onchange="setAge(this.value)"></td>
            <td>年龄：<input id="age" type="text" value=""></td>
        </tr>
        <tr>
            <td>联系电话：<input id="telephone" type="text" value=""></td>
            <td>邮箱：<input id="email" type="text" value=""></td>
            <td>婚姻：<select id="maritalStatus"><option value="0">未婚</option><option value="1">已婚</option></select></td>
            <td>身份证：<input id="idCard" type="text" value=""></td>
        </tr>
        <tr>
            <td>血型：<input id="bloodType" type="text" value=""></td>
            <td>体重：<input id="weight" type="text" value="">kg</td>
            <td colspan="2">过敏史：<input id="allergicHistory" type="text"></td>
        </tr>
        <tr>
            <td>地址：<input id="address" type="text"></td>
            <td>权限代理：<select id="isAgent"><option selected value="0">否</option><option value="1">是</option></select></td>
            <td>床位号：<input id="bedNum" type="text"></td>
        </tr>
    </table>
</div>
<div id="case" style="height: 800px">
    <table>
        <tr>
            <td>邀请会诊医院及科室名称：</td>
            <td><textarea id="hosAndDept"></textarea></td>
        </tr>
        <tr>
            <td>与会医生</td>
            <td><textarea id="doctors"></textarea></td>
        </tr>
        <tr>
            <td>会诊原因和目的：</td>
            <td><input id="aim" type="text" value=""></td>
        </tr>
        <tr>
            <td>病情摘要</td>
            <td><input id="summary" type="text" value=""></td>
        </tr>
        <tr>
            <td>体格检查</td>
            <td><textarea id="phyExam"></textarea></td>
        </tr>
        <tr>
            <td>医技报告</td>
            <td><textarea id="medicalRecord"></textarea></td>
        </tr>
        <tr>
            <td>会诊意见：</td>
            <td><textarea id="opinion"></textarea></td>
        </tr>
        <tr>
            <td>建议：</td>
            <td><textarea id="suggestion"></textarea></td>
        </tr>

        <tr>
            <td>备注</td>
            <td><textarea id="remark"></textarea></td>
        </tr>

    </table>

</div>
<div id="save_btn" style="height: 100px;text-align: center">
    <input type="button" class="btn" value="保存更新" onclick="updateConsultation()">
</div>
</body>
</html>